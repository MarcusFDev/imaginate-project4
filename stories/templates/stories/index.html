{% extends "base.html" %}

{% block content %}

<!-- index.html content starts here -->
<div class="container-fluid min-vh-80">
    <div class="row">
        <div class="col-12 mt-3">
            {% if is_paginated %}
            <nav aria-label="Page navigation">
                <ul class="pagination">
                    {% if page_obj.has_next %}
                    <li><a href="?page={{ page_obj.next_page_number }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}"
                            class=""> NEXT &raquo;</a></li>
                    {% endif %}
                    {% if page_obj.has_previous %}
                    <li><a href="?page={{ page_obj.previous_page_number }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}"
                            class=""> &laquo; PREVIOUS</a></li>
                    {% endif %}
                </ul>

                <a id="dropdownMenuButton" class="text-white ps-1" type="button" data-bs-toggle="dropdown"
                    aria-expanded="false">
                    <i class="fa-solid fa-filter icon-bg"></i>
                </a>

                <ul class="dropdown-menu bg-rich-black border-glow" aria-labelledby="dropdownMenuButton">
                    <li><a class="dropdown-item text-white" href="?sort=upvotes_desc">Most Upvotes</a></li>
                    <li><a class="dropdown-item text-white" href="?sort=upvotes_asc">Least Upvotes</a></li>
                    <li><a class="dropdown-item text-white" href="?sort=created_on_desc">Newest</a></li>
                    <li><a class="dropdown-item text-white" href="?sort=created_on_asc">Oldest</a></li>
                </ul>
            </nav>
            {% endif %}
        </div>

        <!-- Story Entries Column -->
        <div class="col-12 mt-3">
            <div class="row justify-content-center">
                {% for story in story_list %}
                <div class="col-md-4">
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="image-container">
                                <div class="image-flash">

                                </div>
                            </div>
                            <a href="{% url 'story_page' story.slug %}" class="post-link"
                                style="text-decoration: none; color: black;">
                                <h2 class="card-title">{{ story.title }}</h2>
                                <p class="author">Author: {{ story.author }}</p>
                                <p class="card-text">{{ story.excerpt }}</p>
                            </a>

                            <hr>
                            <p class="card-text text-muted h6">
                                {{ story.created_on}}
                            </p>
                            <p class="card-text text-muted h6 fs-3">
                                <i class="fa-solid fa-heart text-danger pe-2"></i>{{ story.upvotes }}
                            </p>
                        </div>
                    </div>
                </div>
                {% if forloop.counter|divisibleby:2 %}
            </div>
            <div class="row justify-content-center">
                {% endif %}
                {% endfor %}

            </div>
        </div>
    </div>
</div>
<div class="container-fluid px-0">
    {% if is_paginated %}
    <!-- Paginator -->
    <div class="paginator-section d-flex justify-content-center align-items-center">
        <nav aria-label="Page navigation">
            <ul class="pagination pagination-lg justify-content-center paginator">
                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page=1{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}"
                        aria-label="First">
                        <span aria-hidden="true"><i class="fa-solid fa-left-long"></i> First</span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link"
                        href="?page={{ page_obj.previous_page_number }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}"
                        aria-label="Previous">
                        <span aria-hidden="true"><i class="fa-solid fa-arrow-left"></i></span>
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <a class="page-link" aria-label="First">
                        <span aria-hidden="true"><i class="fa-solid fa-left-long"></i> First</span>
                    </a>
                </li>
                <li class="page-item disabled">
                    <a class="page-link" aria-label="Previous">
                        <span aria-hidden="true"><i class="fa-solid fa-arrow-left"></i></span>
                    </a>
                </li>
                {% endif %}
    
                <!-- Page numbers with ellipses -->
                {% if page_obj.number > 4 %}
                <li class="page-item">
                    <a class="page-link" href="?page=1{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">1</a>
                </li>
                <li class="page-item disabled">
                    <span class="page-link">…</span>
                </li>
                {% endif %}
    
                {% for num in page_obj.paginator.page_range %}
                {% if num == page_obj.number %}
                <li class="page-item active" aria-current="page">
                    <span class="page-link">{{ num }}</span>
                </li>
                {% elif num > page_obj.number|add:'-2' and num < page_obj.number|add:'3' %}
                <li class="page-item">
                    <a class="page-link"
                        href="?page={{ num }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">{{ num }}</a>
                </li>
                {% endif %}
                {% endfor %}
    
                {% if page_obj.number < page_obj.paginator.num_pages|add:'-3' %}
                <li class="page-item disabled">
                    <span class="page-link">…</span>
                </li>
                <li class="page-item">
                    <a class="page-link"
                        href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">{{ page_obj.paginator.num_pages }}</a>
                </li>
                {% endif %}
    
                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link"
                        href="?page={{ page_obj.next_page_number }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}"
                        aria-label="Next">
                        <span aria-hidden="true"><i class="fa-solid fa-arrow-right"></i></span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link"
                        href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}"
                        aria-label="Last">
                        <span aria-hidden="true">Last <i class="fa-solid fa-right-long"></i></span>
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <a class="page-link" aria-label="Next">
                        <span aria-hidden="true"><i class="fa-solid fa-arrow-right"></i></span>
                    </a>
                </li>
                <li class="page-item disabled">
                    <a class="page-link" aria-label="Last">
                        <span aria-hidden="true">Last <i class="fa-solid fa-right-long"></i></span>
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
    </div>    
    {% endif %}
</div>

{% endblock %}